<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VerveStacks Code Documentation</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: #333;
            background-color: #f8f9fa;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .header {
            text-align: center;
            margin-bottom: 40px;
            padding: 30px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }
        
        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }
        
        .header p {
            font-size: 1.2em;
            opacity: 0.9;
        }
        
        .quick-start {
            background: white;
            padding: 25px;
            border-radius: 10px;
            margin-bottom: 30px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .quick-start h2 {
            color: #667eea;
            margin-bottom: 15px;
            font-size: 1.5em;
        }
        
        .command-box {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 5px;
            padding: 15px;
            margin: 10px 0;
            font-family: 'Courier New', monospace;
            font-size: 0.9em;
        }
        
        .modules-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .module-card {
            background: white;
            border-radius: 10px;
            padding: 25px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            cursor: pointer;
            border-left: 4px solid #667eea;
        }
        
        .module-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
        }
        
        .module-card h3 {
            color: #667eea;
            margin-bottom: 10px;
            font-size: 1.3em;
        }
        
        .module-card .purpose {
            color: #666;
            margin-bottom: 15px;
            font-style: italic;
        }
        
        .module-card .functions {
            margin-bottom: 15px;
        }
        
        .module-card .functions h4 {
            font-size: 0.9em;
            color: #333;
            margin-bottom: 8px;
        }
        
        .function-list {
            list-style: none;
            padding: 0;
        }
        
        .function-list li {
            background: #f8f9fa;
            padding: 5px 10px;
            margin: 3px 0;
            border-radius: 3px;
            font-family: 'Courier New', monospace;
            font-size: 0.8em;
        }
        
        .status {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 0.7em;
            font-weight: bold;
            text-transform: uppercase;
        }
        
        .status.core { background: #d1ecf1; color: #0c5460; }
        .status.utility { background: #d4edda; color: #155724; }
        .status.interface { background: #fff3cd; color: #856404; }
        .status.data { background: #f8d7da; color: #721c24; }
        
        .flow-diagram {
            background: white;
            padding: 25px;
            border-radius: 10px;
            margin-bottom: 30px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .search-box {
            width: 100%;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 1em;
            margin-bottom: 20px;
        }
        
        .breadcrumb {
            background: #e9ecef;
            padding: 10px 15px;
            border-radius: 5px;
            margin-bottom: 20px;
            font-size: 0.9em;
        }
        
        .breadcrumb a {
            color: #667eea;
            text-decoration: none;
        }
        
        .breadcrumb a:hover {
            text-decoration: underline;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>VerveStacks Code Documentation</h1>
            <p>Your guide back into the energy systems modeling pipeline</p>
        </div>
        
        <div class="quick-start">
            <h2>ðŸš€ Quick Start - Getting Back Into It</h2>
            <p><strong>What this does:</strong> Creates country-specific VEDA/TIMES energy system models from global datasets (IRENA, Ember, GEM) with automated spatial distribution and grid modeling.</p>
            
            <h3>Most Common Commands:</h3>
            <div class="command-box">python main.py --iso CHE --grid-modeling</div>
            <div class="command-box">python main.py --iso USA --grid-modeling --no-git</div>
            <div class="command-box">python main.py --list-isos</div>
            
            <h3>Key Concepts to Remember:</h3>
            <ul>
                <li><strong>REZ:</strong> Renewable Energy Zones - 50x50km grid cells for solar/wind placement</li>
                <li><strong>comm-out:</strong> Commodity output field - defines what type of energy each plant produces</li>
                <li><strong>Grid modeling:</strong> When enabled, assigns spatial commodities (e.g., elc_spv-CHE_0007, e_w123)</li>
                <li><strong>Thermal distribution:</strong> Gap capacity distributed based on existing fuel-specific plant locations</li>
            </ul>
        </div>
        
        <input type="text" class="search-box" placeholder="Search modules, functions, or concepts..." id="searchBox">
        
        <div class="modules-grid" id="modulesGrid">
            <div class="module-card" onclick="location.href='modules/main.html'">
                <h3>main.py</h3>
                <span class="status interface">Interface</span>
                <div class="purpose">CLI entry point - parses arguments and dispatches to processor</div>
                <div class="functions">
                    <h4>Key Functions:</h4>
                    <ul class="function-list">
                        <li>main() - CLI argument parsing</li>
                        <li>setup_logging() - Configure logging</li>
                    </ul>
                </div>
                <p><strong>Calls:</strong> VerveStacksProcessor.process_iso()</p>
            </div>
            
            <div class="module-card" onclick="location.href='modules/verve_stacks_processor.html'">
                <h3>verve_stacks_processor.py</h3>
                <span class="status core">Core</span>
                <div class="purpose">Master orchestrator - loads global data and runs country processing pipeline</div>
                <div class="functions">
                    <h4>Key Functions:</h4>
                    <ul class="function-list">
                        <li>process_iso() - Main pipeline</li>
                        <li>load_global_data() - Cache management</li>
                        <li>get_available_isos() - List countries</li>
                    </ul>
                </div>
                <p><strong>Calls:</strong> existing_stock_processor, time_slice_processor, veda_model_creator</p>
            </div>
            
            <div class="module-card" onclick="location.href='modules/existing_stock_processor.html'">
                <h3>existing_stock_processor.py</h3>
                <span class="status core">Core</span>
                <div class="purpose">Heart of the logic - processes GEM plants, adds IRENA/Ember gap capacity, assigns spatial commodities</div>
                <div class="functions">
                    <h4>Key Functions:</h4>
                    <ul class="function-list">
                        <li>process_gem_data() - Main processing flow</li>
                        <li>add_missing_irena_capacity() - Solar/wind/hydro gaps</li>
                        <li>add_missing_ember_capacity() - Thermal gaps</li>
                        <li>assign_single_commodity() - Single-pass comm-out assignment</li>
                    </ul>
                </div>
                <p><strong>Recent Work:</strong> Implemented clean spatial distribution with 10MW threshold</p>
            </div>
            
            <div class="module-card" onclick="location.href='modules/spatial_utils.html'">
                <h3>spatial_utils.py</h3>
                <span class="status utility">Utility</span>
                <div class="purpose">Spatial distribution engine - REZ weights, thermal distribution, commodity mapping</div>
                <div class="functions">
                    <h4>Key Functions:</h4>
                    <ul class="function-list">
                        <li>calculate_capacity_distribution() - Unified distributor</li>
                        <li>calculate_thermal_bus_weights() - Fuel-specific distribution</li>
                        <li>calculate_rez_weights() - REZ-based distribution</li>
                        <li>rez_id_to_commodity() - REZ â†’ commodity conversion</li>
                        <li>bus_id_to_commodity() - Bus â†’ commodity conversion</li>
                    </ul>
                </div>
                <p><strong>Recent Work:</strong> Added thermal distribution with voltage fallback</p>
            </div>
            
            <div class="module-card" onclick="location.href='modules/time_slice_processor.html'">
                <h3>time_slice_processor.py</h3>
                <span class="status core">Core</span>
                <div class="purpose">Temporal modeling - processes hourly profiles into VEDA time-slices</div>
                <div class="functions">
                    <h4>Key Functions:</h4>
                    <ul class="function-list">
                        <li>process_time_slices() - Main TS processing</li>
                        <li>process_hourly_data() - Load/weather profiles</li>
                        <li>create_time_slice_mapping() - Hour â†’ slice mapping</li>
                    </ul>
                </div>
                <p><strong>Handles:</strong> Solar/wind profiles, demand curves, seasonal patterns</p>
            </div>
            
            <div class="module-card" onclick="location.href='modules/veda_model_creator.html'">
                <h3>veda_model_creator.py</h3>
                <span class="status interface">Interface</span>
                <div class="purpose">VEDA model assembly - creates Excel files, Git branches, model structure</div>
                <div class="functions">
                    <h4>Key Functions:</h4>
                    <ul class="function-list">
                        <li>create_veda_model() - Main model creation</li>
                        <li>setup_git_branch() - Version control</li>
                        <li>write_excel_files() - VEDA Excel structure</li>
                    </ul>
                </div>
                <p><strong>Outputs:</strong> Complete VEDA model ready for TIMES</p>
            </div>
            
            <div class="module-card" onclick="location.href='modules/grid_modeling.html'">
                <h3>grid_modeling.py</h3>
                <span class="status utility">Utility</span>
                <div class="purpose">Grid infrastructure - bus clustering, transmission links, spatial mapping</div>
                <div class="functions">
                    <h4>Key Functions:</h4>
                    <ul class="function-list">
                        <li>process_grid_modeling() - Grid processing pipeline</li>
                        <li>cluster_buses() - DBSCAN bus clustering</li>
                        <li>create_transmission_links() - Grid connections</li>
                    </ul>
                </div>
                <p><strong>Integrates:</strong> PyPSA networks, OSM data, REZoning</p>
            </div>
            
            <div class="module-card" onclick="location.href='modules/shared_data_loader.html'">
                <h3>shared_data_loader.py</h3>
                <span class="status data">Data</span>
                <div class="purpose">Global data management - caches IRENA, Ember, GEM, REZoning datasets</div>
                <div class="functions">
                    <h4>Key Functions:</h4>
                    <ul class="function-list">
                        <li>get_shared_loader() - Singleton access</li>
                        <li>load_cached_data() - Cache management</li>
                        <li>refresh_cache() - Force reload</li>
                    </ul>
                </div>
                <p><strong>Manages:</strong> 1.5GB+ of global energy data with smart caching</p>
            </div>
            
            <div class="module-card" onclick="location.href='modules/excel_manager.html'">
                <h3>excel_manager.py</h3>
                <span class="status utility">Utility</span>
                <div class="purpose">Excel operations - xlwings integration, formula refresh, professional formatting</div>
                <div class="functions">
                    <h4>Key Functions:</h4>
                    <ul class="function-list">
                        <li>write_with_xlwings() - Excel file creation</li>
                        <li>apply_professional_formatting() - Styling</li>
                        <li>refresh_formulas() - Calculate workbook</li>
                    </ul>
                </div>
                <p><strong>Note:</strong> Uses xlwings for formula refresh after updates</p>
            </div>
        </div>
        
        <div class="flow-diagram">
            <h2>ðŸ“Š System Flow Overview</h2>
            <svg width="100%" height="400" viewBox="0 0 1000 400">
                <!-- Main flow -->
                <rect x="50" y="50" width="100" height="60" fill="#667eea" stroke="#333" rx="5"/>
                <text x="100" y="85" text-anchor="middle" fill="white" font-size="12">main.py</text>
                
                <rect x="200" y="50" width="150" height="60" fill="#764ba2" stroke="#333" rx="5"/>
                <text x="275" y="85" text-anchor="middle" fill="white" font-size="12">VerveStacks</text>
                <text x="275" y="100" text-anchor="middle" fill="white" font-size="12">Processor</text>
                
                <rect x="400" y="50" width="150" height="60" fill="#52c41a" stroke="#333" rx="5"/>
                <text x="475" y="75" text-anchor="middle" fill="white" font-size="10">existing_stock</text>
                <text x="475" y="90" text-anchor="middle" fill="white" font-size="10">_processor</text>
                <text x="475" y="105" text-anchor="middle" fill="white" font-size="10">(spatial magic)</text>
                
                <rect x="600" y="50" width="120" height="60" fill="#fa8c16" stroke="#333" rx="5"/>
                <text x="660" y="75" text-anchor="middle" fill="white" font-size="10">time_slice</text>
                <text x="660" y="90" text-anchor="middle" fill="white" font-size="10">_processor</text>
                <text x="660" y="105" text-anchor="middle" fill="white" font-size="10">(temporal)</text>
                
                <rect x="750" y="50" width="120" height="60" fill="#eb2f96" stroke="#333" rx="5"/>
                <text x="810" y="75" text-anchor="middle" fill="white" font-size="10">veda_model</text>
                <text x="810" y="90" text-anchor="middle" fill="white" font-size="10">_creator</text>
                <text x="810" y="105" text-anchor="middle" fill="white" font-size="10">(Excel output)</text>
                
                <!-- Arrows -->
                <path d="M 150 80 L 190 80" fill="none" stroke="#333" stroke-width="2" marker-end="url(#arrowhead)"/>
                <path d="M 350 80 L 390 80" fill="none" stroke="#333" stroke-width="2" marker-end="url(#arrowhead)"/>
                <path d="M 550 80 L 590 80" fill="none" stroke="#333" stroke-width="2" marker-end="url(#arrowhead)"/>
                <path d="M 720 80 L 740 80" fill="none" stroke="#333" stroke-width="2" marker-end="url(#arrowhead)"/>
                
                <!-- Data sources -->
                <rect x="50" y="200" width="80" height="40" fill="#f0f0f0" stroke="#333" rx="3"/>
                <text x="90" y="225" text-anchor="middle" font-size="10">IRENA</text>
                
                <rect x="150" y="200" width="80" height="40" fill="#f0f0f0" stroke="#333" rx="3"/>
                <text x="190" y="225" text-anchor="middle" font-size="10">Ember</text>
                
                <rect x="250" y="200" width="80" height="40" fill="#f0f0f0" stroke="#333" rx="3"/>
                <text x="290" y="225" text-anchor="middle" font-size="10">GEM</text>
                
                <rect x="350" y="200" width="80" height="40" fill="#f0f0f0" stroke="#333" rx="3"/>
                <text x="390" y="225" text-anchor="middle" font-size="10">REZoning</text>
                
                <!-- Data arrows -->
                <path d="M 90 200 L 450 120" fill="none" stroke="#666" stroke-width="1" stroke-dasharray="3,3"/>
                <path d="M 190 200 L 460 120" fill="none" stroke="#666" stroke-width="1" stroke-dasharray="3,3"/>
                <path d="M 290 200 L 470 120" fill="none" stroke="#666" stroke-width="1" stroke-dasharray="3,3"/>
                <path d="M 390 200 L 480 120" fill="none" stroke="#666" stroke-width="1" stroke-dasharray="3,3"/>
                
                <!-- Output -->
                <rect x="400" y="300" width="200" height="60" fill="#1890ff" stroke="#333" rx="5"/>
                <text x="500" y="325" text-anchor="middle" fill="white" font-size="12">VEDA Model</text>
                <text x="500" y="345" text-anchor="middle" fill="white" font-size="10">(Excel + Git branch)</text>
                
                <path d="M 810 110 L 600 290" fill="none" stroke="#333" stroke-width="2" marker-end="url(#arrowhead)"/>
                
                <!-- Arrow marker -->
                <defs>
                    <marker id="arrowhead" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
                        <polygon points="0 0, 10 3.5, 0 7" fill="#333"/>
                    </marker>
                </defs>
            </svg>
        </div>
    </div>
    
    <script>
        // Search functionality
        document.getElementById('searchBox').addEventListener('input', function(e) {
            const searchTerm = e.target.value.toLowerCase();
            const cards = document.querySelectorAll('.module-card');
            
            cards.forEach(card => {
                const text = card.textContent.toLowerCase();
                if (text.includes(searchTerm)) {
                    card.style.display = 'block';
                } else {
                    card.style.display = 'none';
                }
            });
        });
        
        // Module card hover effects
        document.querySelectorAll('.module-card').forEach(card => {
            card.addEventListener('mouseenter', function() {
                this.style.borderLeftWidth = '6px';
            });
            
            card.addEventListener('mouseleave', function() {
                this.style.borderLeftWidth = '4px';
            });
        });
    </script>
</body>
</html>
